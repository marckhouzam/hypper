<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Hypper documentation</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="user/tutorials/installing.html"><strong aria-hidden="true">2.</strong> Installing</a></li><li class="chapter-item expanded "><a href="user/tutorials/quickstart.html"><strong aria-hidden="true">3.</strong> Quick Start</a></li><li class="chapter-item expanded "><a href="user/howto/index.html"><strong aria-hidden="true">4.</strong> How tos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="user/howto/pull.html"><strong aria-hidden="true">4.1.</strong> Pulling charts to the local machine</a></li><li class="chapter-item expanded "><a href="user/howto/expandcharthypper.html"><strong aria-hidden="true">4.2.</strong> Expand a chart with Hypper annotations</a></li><li class="chapter-item expanded "><a href="user/howto/lintchart.html"><strong aria-hidden="true">4.3.</strong> Lint charts</a></li><li class="chapter-item expanded "><a href="user/howto/search.html"><strong aria-hidden="true">4.4.</strong> Search repos for Hypper charts</a></li><li class="chapter-item expanded "><a href="user/howto/shared-deps.html"><strong aria-hidden="true">4.5.</strong> Work with shared dependencies</a></li></ol></li><li class="chapter-item expanded "><a href="reference-guides.html"><strong aria-hidden="true">5.</strong> Reference guides</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Hypper documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/rancher-sandbox/hypper" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>Hypper provides Kubernetes package management for cluster admins. It is a
package manager built on Helm and inspired by other package managers like
zypper.</p>
<h2><a class="header" href="#how-hypper-differs-from-helm" id="how-hypper-differs-from-helm">How Hypper Differs From Helm</a></h2>
<p>Why build a package manager on a package manager? Helm is a package manager that
tries to make few assumptions. For example, Custom Resource Definitions (CRD)s
are a Kubernetes resource that extend the Kubernetes API. They can be used in
various ways and there are pitfalls with them. Helm makes very few assumptions
when it comes to them. Hypper is going to make some different assumptions which
will result in different features.</p>
<p>As differences between Hypper and Helm arise they will be documented along with
the reasons for the difference. This is in an effort to provide clarity.</p>
<p>When features from Hypper can be upstreamed into Helm they will be. In that way,
Hypper can act as a testing ground for Helm. We do not expect that every feature
will fit in upstream Helm.</p>
<p>A second element in the difference is that Helm, as a package manager, does not
handle environment deployment operations. Those are left to higher level tools
like Helmfile (a push model like Ansible) and the Flux Helm Operator (a pull
model like Chef). Helm expects higher level tools will use Helm and charts for
operating in different environments.</p>
<p>Hypper makes some assumptions that move it more towards the environment
management. This is in a different way from Helmfile or the Flux Helm Operator,
but further than Helm nevertheless.</p>
<h3><a class="header" href="#hypper-features-not-in-helm" id="hypper-features-not-in-helm">Hypper Features Not In Helm</a></h3>
<h4><a class="header" href="#repeatable-install-with-defined-release-name-and-namespace" id="repeatable-install-with-defined-release-name-and-namespace">Repeatable Install with defined Release Name and Namespace</a></h4>
<p>When dealing with system level charts you may want to have them be installed in
the same namespace or with the same release name everywhere. For example, when
you install a cluster wide logging service. With Hypper, you can capture this
information as an annotation and only specify a different one if you want to
override the default. Then when you tell Hypper to install your service it will
be installed to the same location, in a repeatable manner.</p>
<h4><a class="header" href="#shared-dependencies" id="shared-dependencies">Shared Dependencies</a></h4>
<p>Sometimes you want to have a shared system dependency. For example, you may want
to have just a single Prometheus or Istio in a cluster. When you install an
application that depends on this shared dependency you want to install it if not
present and leverage the existing one if present.</p>
<p>The additional metadata to signify these relationships will be stored as Helm
chart annotations.</p>
<h4><a class="header" href="#optional-shared-dependencies" id="optional-shared-dependencies">Optional Shared Dependencies</a></h4>
<p>There are occasions where you may want a shared dependency to be optional.
Instead of being checked and installed all the time you want Hypper to prompt
you about using it. Or, you can tell it what to do using flags.</p>
<p>Hypper provides this ability for the direct chart you want to install and the
additional metadata is stored in annotations.</p>
<h2><a class="header" href="#client-application-and-software-development-kit-sdk" id="client-application-and-software-development-kit-sdk">Client Application and Software Development Kit (SDK)</a></h2>
<p>Hypper provides both a client application you can use in a terminal and a SDK
in Go that you can use for the development of your applications. The
documentation provided here primarily focuses on chart customizations for
Hypper and the client application.</p>
<p>The SDK documentation can be found at
<a href="https://pkg.go.dev/github.com/rancher-sandbox/hypper">pkg.go.dev/github.com/rancher-sandbox/hypper</a>.
The client source provides an example of using the SDK and is in the <code>cmd</code>
sub-directory.</p>
<h1><a class="header" href="#installing-hypper" id="installing-hypper">Installing Hypper</a></h1>
<p>This guide shows how to install the Hypper CLI. Hypper can be installed either from source, or from pre-built binary releases.</p>
<h2><a class="header" href="#from-binary-releases-linux-macos-windows" id="from-binary-releases-linux-macos-windows">From binary releases (Linux, macOS, Windows)</a></h2>
<p>Every <a href="https://github.com/rancher-sandbox/hypper/releases">release</a> of Hypper provides binaries for a variety of OSes. These binary versions can be manually downloaded and installed.</p>
<ul>
<li>Download your <a href="https://github.com/rancher-sandbox/hypper/releases">desired version</a></li>
<li>Unpack it (<code>tar -zxvf hypper-v0.0.2-linux-amd64.tar.gz</code>)</li>
<li>Find the hypper binary in the unpacked directory, and move it to its desired destination (<code>mv linux-amd64/hypper /usr/local/bin/hypper</code>)</li>
</ul>
<p>From there, you should be able to run the client and add the stable repo: see <code>hypper help</code>.</p>
<h2><a class="header" href="#from-script-linux-macos-windows" id="from-script-linux-macos-windows">From script (Linux, macOS, windows)</a></h2>
<p>Hypper now has an installer script that will automatically grab the latest version of hypper and install it locally.</p>
<p>You can fetch that script, and then execute it locally. It's well documented so that you can read through it and understand what it is doing before you run it.</p>
<pre><code>$ curl -fsSL -o get_hypper https://raw.githubusercontent.com/rancher-sandbox/hypper/main/scripts/get-hypper
$ chmod 700 get_hypper
$ ./get-hypper
</code></pre>
<p>Yes, you can <code>curl https://raw.githubusercontent.com/rancher-sandbox/hypper/main/scripts/get-hypper | bash</code> if you want to live on the edge.</p>
<p><strong>NOTE</strong></p>
<p><em>For installing using the script you need bash, curl/wget, and tar (openssl and sudo are optional).
Please check how you can install those requisites in your OS if needed.</em> </p>
<h2><a class="header" href="#from-source-linux-macos-windows" id="from-source-linux-macos-windows">From source (Linux, macOS, Windows)</a></h2>
<p>Building Hypper from source is a bit more work, but the best way to test the
latest (pre-release) Hypper version.</p>
<p>You must have a working Go environment (1.14+), and a POSIX environment with the proper tools installed (git, make).</p>
<p>For Windows, Hypper has been tested under <a href="https://www.cygwin.com/">cygwin</a> and it compiles correctly.</p>
<pre><code class="language-console">$ git clone https://github.com/rancher-sandbox/hypper/hypper.git
$ cd hypper
$ make
</code></pre>
<p>If required, it will fetch the dependencies and cache them, and validate
configuration.
It will then compile <code>hypper</code>, and place it in <code>bin/hypper</code> (<code>bin/hypper.exe</code> for windows).</p>
<h2><a class="header" href="#from-development-builds" id="from-development-builds">From development builds</a></h2>
<p>In addition to releases you can download and install development snapshots of
Hypper from <a href="https://github.com/rancher-sandbox/hypper/actions/workflows/ci.yml?query=branch%3Amain+is%3Asuccess+workflow%3ACI">Github Actions</a>.</p>
<p>On each successful CI run, artifacts are stored for that run. Just download the binaries and follow the same steps as installing from binary releases.</p>
<p><strong>NOTE</strong></p>
<p><em>Development snapshots could be in a broken state, with missing functionality or breaking changes.
We do not recommend using development snapshots on your production environment.</em></p>
<h2><a class="header" href="#conclusion" id="conclusion">Conclusion</a></h2>
<p>In most cases, installation is as simple as getting a pre-built hypper binary. This document covers additional cases for those who want to do more sophisticated things with Hypper.</p>
<p>Once you have the Hypper Client successfully installed, you can move on to the <a href="user/tutorials/./quickstart.html">quickstart guide</a>.</p>
<h1><a class="header" href="#quickstart" id="quickstart">Quickstart</a></h1>
<p>This guide covers how you can quickly get started using Hypper.</p>
<p>If you already know Helm, this will be a breeze, as Hypper follows Helm's workflow
and extends its functionalities to install Helm charts that have been extended
to work with Hypper.</p>
<h2><a class="header" href="#prerequisites" id="prerequisites">Prerequisites</a></h2>
<p>The following prerequisites are required:</p>
<ol>
<li>A Kubernetes cluster.</li>
<li>A Chart repository to install charts from.</li>
</ol>
<h2><a class="header" href="#install-hypper" id="install-hypper">Install Hypper</a></h2>
<p>See the <a href="user/tutorials/./installing.html">installation guide</a>.</p>
<h2><a class="header" href="#configuring-hypper-by-initializing-repositories" id="configuring-hypper-by-initializing-repositories">Configuring Hypper by initializing repositories</a></h2>
<p>Hypper enables you to deploy Helm and Hypper charts into your Kubernetes
cluster. To simplify that, the best way is to add a chart repository, for
example one with Helm charts:</p>
<pre><code class="language-console">$ hypper repo add bitnami https://charts.bitnami.com/bitnami
</code></pre>
<p>You can add several repositories. Let's add a repository containing charts
with some Hypper functionality:</p>
<pre><code class="language-console">$ hypper repo add hypper-charts https://rancher-sandbox.github.io/hypper-charts/repo
</code></pre>
<p>Now, you can list the repositories that Hypper can install charts from:</p>
<pre><code class="language-console">$ hypper repo list
NAME            URL
bitnami         https://charts.bitnami.com/bitnami
hypper-charts   https://rancher-sandbox.github.io/hypper-charts/repo
</code></pre>
<h2><a class="header" href="#install-an-example-helm-chart" id="install-an-example-helm-chart">Install an example Helm chart</a></h2>
<p>To install a chart, you can run the <code>hypper install</code> command. Hypper has several
ways to find and install a chart, but the easiest is to use a repository, in
this case the Bitnami chart repository.</p>
<pre><code class="language-console">$ hypper install mariadb bitnami/mariadb
🛳  Installing chart &quot;mariadb&quot; as &quot;mariadb&quot; in namespace &quot;default&quot;…
👏 Done!
</code></pre>
<p>Whenever you install a chart, a new release is created. So one Helm chart can be
installed multiple times into the same cluster. And each can be independently
managed and upgraded.</p>
<h2><a class="header" href="#install-an-example-hypper-chart" id="install-an-example-hypper-chart">Install an example Hypper chart</a></h2>
<p>Hypper charts are supersets of Helm charts with more functionality, such as
specifying default release name, namespace of installation, or installing
shared-dependency charts automatically.
They are thought to be installed system-wide in the cluster: 1 Hypper chart for
all users of the cluster. Think of them as typical system OS libraries/services.</p>
<p>The commands are the same as you have already used:</p>
<pre><code class="language-console">$ hypper install hypper-charts/our-app
❓ Install optional shared dependency &quot;rancher-tracing&quot; of chart &quot;demo&quot;? [Y/n]:
y
The following charts are going to be installed:
our-app v0.1.0
 ├─ fleet v0.3.500
 └─ rancher-tracing v1.20.002

🛳  Installing chart &quot;fleet&quot; as &quot;fleet&quot; in namespace &quot;fleet-system&quot;…
🛳  Installing chart &quot;rancher-tracing&quot; as &quot;rancher-tracing&quot; in namespace &quot;istio-system&quot;…
🛳  Installing chart &quot;our-app&quot; as &quot;our-app-name&quot; in namespace &quot;hypper&quot;…
👏 Done!
</code></pre>
<p>This time, the chart got installed with a default name <code>our-app-name</code>, and into
a default namespace  <code>hypper</code>. Hypper to creates the namespace if it doesn't
exist (you can pass <code>--no-create-namespace</code> if you don't want that). It also
installed its defined shared and optional shared dependencies.</p>
<h2><a class="header" href="#learn-about-releases" id="learn-about-releases">Learn about releases</a></h2>
<p>It's easy to see what has been released with hypper:</p>
<pre><code class="language-console">$ hypper ls --all-namespaces
NAME            NAMESPACE       REVISION        UPDATED                                         STATUS          CHART                           APP VERSION
fleet           fleet-system    1               2021-05-18 15:44:16.11805509 +0200 CEST         deployed        fleet-0.3.500                   0.3.5
mariadb         default         1               2021-05-18 15:44:43.106328879 +0200 CEST        deployed        mariadb-9.3.11                  10.5.10
our-app-name    hypper          1               2021-05-18 15:44:18.687033582 +0200 CEST        deployed        our-app-0.0.2                   0.0.1
rancher-tracing istio-system    1               2021-05-18 15:44:18.592656807 +0200 CEST        deployed        rancher-tracing-1.20.002        1.20.0
</code></pre>
<h2><a class="header" href="#uninstall-a-release" id="uninstall-a-release">Uninstall a release</a></h2>
<p>To uninstall a release, use the hypper uninstall command:</p>
<pre><code class="language-console">$ hypper uninstall fleet -n fleet-system
🔥  uninstalling fleet
✅  release &quot;fleet&quot; uninstalled
</code></pre>
<p>This will uninstall fleet from Kubernetes, which will remove all resources
associated with the release as well as the release history.</p>
<p>If the flag <code>--keep-history</code> is provided, release history will be kept. You will
be able to request information about that release:</p>
<pre><code class="language-console">$ hypper status fleet -n fleet-system
NAME: fleet
LAST DEPLOYED: Fri Mar 12 12:14:28 2021
NAMESPACE: fleet-system
STATUS: uninstalled
REVISION: 1
TEST SUITE: None
</code></pre>
<h2><a class="header" href="#read-the-help-text" id="read-the-help-text">Read the help text</a></h2>
<p>To learn more about available Hypper commands, use <code>hypper help</code>, or type a
command followed by the <code>-h</code> flag: <code>hypper install -h</code>.</p>
<p>This section contains some &quot;How tos&quot; that offer practical advice and detailed instruction in an activity. </p>
<h1><a class="header" href="#pulling-charts-to-the-local-machine" id="pulling-charts-to-the-local-machine">Pulling charts to the local machine</a></h1>
<p>Sometimes there is a need to modify charts from a repo or just have a look at what the chart is actually doing.</p>
<p>For that you can use <code>hypper pull</code>, which will download the chart to your local machine.</p>
<h2><a class="header" href="#pulling-a-chart" id="pulling-a-chart">Pulling a chart</a></h2>
<pre><code class="language-shell">$ hypper pull hypper-charts/fleet
$ ls fleet*
fleet-0.3.500.tgz
</code></pre>
<h2><a class="header" href="#pulling-a-chart-and-extracting-it" id="pulling-a-chart-and-extracting-it">Pulling a chart and extracting it</a></h2>
<p>Usually, pull will download the tar.gz chart package, but you can use <code>--untar</code> so instead the package is extracted automatically.</p>
<pre><code class="language-shell">$ hypper pull hypper-charts/fleet --untar
$ ls fleet/     
charts  Chart.yaml  templates  values.yaml
</code></pre>
<h2><a class="header" href="#pulling-a-specific-chart-version" id="pulling-a-specific-chart-version">Pulling a specific chart version</a></h2>
<p>Pull will automatically download the latest chart version, but you can use <code>--version</code> to get the specified version instead.</p>
<pre><code class="language-shell">$ hypper pull hypper-charts/fleet --version 0.3.500
$ ls fleet*
fleet-0.3.500.tgz
</code></pre>
<h2><a class="header" href="#changing-the-output-dir" id="changing-the-output-dir">Changing the output dir</a></h2>
<p>By default, pull will download the chart into the current dir. Use the <code>-d</code> flag to set the output dir.</p>
<p>Note: The output dir needs to exist beforehand.</p>
<pre><code class="language-shell">$ hypper pull hypper-charts/fleet -d chartslocal
$ ls chartslocal 
fleet-0.3.500.tgz
</code></pre>
<h2><a class="header" href="#pulling-development-versions" id="pulling-development-versions">Pulling development versions</a></h2>
<p>You can use the <code>--devel</code> flag to pull devel versions. By default, hypper won't download, search or list devel version unless specified by the flag.</p>
<pre><code class="language-shell">$ hypper repo add rancher-charts https://charts.rancher.io
$ hypper pull rancher-charts/fleet --version 0.3.600-rc1 --devel
$ ls fleet*
fleet-0.3.600-rc1.tgz
</code></pre>
<h1><a class="header" href="#how-to-expand-a-chart-with-hypper-annotations" id="how-to-expand-a-chart-with-hypper-annotations">How to expand a chart with Hypper annotations</a></h1>
<p>Hypper charts build on top of Helm charts so any chart out there will work out of the box.</p>
<p>But we want to go further, we want to take advantage of Hypper features like release and namespace from annotations.</p>
<p>This is a simple as modifying our <code>Chart.yaml</code> to add to its annotations.</p>
<p>For example using the <a href="https://github.com/bitnami/charts/tree/master/bitnami/mysql">Mysql chart from Bitnami</a> as example, these are the contents of <code>Chart.yaml</code>:</p>
<pre><code class="language-yaml">annotations:
  category: Database
apiVersion: v2
appVersion: 8.0.23
dependencies:
  - name: common
    repository: https://charts.bitnami.com/bitnami
    tags:
      - bitnami-common
    version: 1.x.x
description: Chart to create a Highly available MySQL cluster
home: https://github.com/bitnami/charts/tree/master/bitnami/mysql
icon: https://bitnami.com/assets/stacks/mysql/img/mysql-stack-220x234.png
keywords:
  - mysql
  - database
  - sql
  - cluster
  - high availability
maintainers:
  - email: containers@bitnami.com
    name: Bitnami
name: mysql
sources:
  - https://github.com/bitnami/bitnami-docker-mysql
  - https://mysql.com
version: 8.5.1
</code></pre>
<p>But we want to install it always on the same namespace called <code>databases</code>.</p>
<p>So we will expand the <code>Chart.yaml</code> to look like this:</p>
<pre><code class="language-diff">annotations:
  category: Database
+ hypper.cattle.io/namespace: databases
apiVersion: v2
appVersion: 8.0.23
dependencies:
  - name: common
    repository: https://charts.bitnami.com/bitnami
    tags:
      - bitnami-common
    version: 1.x.x
description: Chart to create a Highly available MySQL cluster
home: https://github.com/bitnami/charts/tree/master/bitnami/mysql
icon: https://bitnami.com/assets/stacks/mysql/img/mysql-stack-220x234.png
keywords:
  - mysql
  - database
  - sql
  - cluster
  - high availability
maintainers:
  - email: containers@bitnami.com
    name: Bitnami
name: mysql
sources:
  - https://github.com/bitnami/bitnami-docker-mysql
  - https://mysql.com
version: 8.5.1
</code></pre>
<p>We added the <code>hypper.cattle.io/namespace: databases</code> to the annotation, so now when we install this chart with Hypper it will install into the proper namespace without any need to passing the value on the CLI:</p>
<pre><code class="language-console">$ hypper install mysql/                 
🛳  Installing chart &quot;mysql&quot; as &quot;mysql&quot; in namespace &quot;databases&quot;…
👏 Done!
</code></pre>
<p>See also how we didn't to specify any name for the release? Hypper is smart enough to try to obtain the name from the annotations (like the namespace!) and if it doesn't find it, it uses the name value on the <code>Chart.yaml</code></p>
<p>If we wanted to specify the release name in the annotations as well, we just need to add <code>hypper.cattle.io/release-name</code> to the annotations as we did above with the namespace and hypper will take care of setting it!</p>
<h2><a class="header" href="#how-to-lint-a-hypper-chart" id="how-to-lint-a-hypper-chart">How to lint a hypper chart</a></h2>
<p>We just created or modified our chart or added annotations to take advantage of Hypper features but...how do we know those annotations are correct?</p>
<p>It's very simple, just run <code>hypper lint</code> against your chart, and it will verify that the chart is well-formed.</p>
<p><code>hypper lint</code> runs both Helm checks and Hypper checks against the chart.</p>
<p>If the linter encounters things that will cause the chart to fail installation,
it will emit <code>[ERROR]</code> messages. If it encounters issues that break with
convention or recommendation, it will emit <code>[WARNING]</code> messages. For optional
features, it will emit <code>[INFO]</code> messages.</p>
<p>First, lets add the hypper-charts repo, to obtain some chart examples:</p>
<pre><code class="language-console">$ hypper repo add hypper-charts 'https://rancher-sandbox.github.io/hypper-charts/repo'
&quot;hypper-charts&quot; has been added to your repositories
$ hypper repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the &quot;hypper-charts&quot; chart repository
🛳  Update Complete.
$ hypper pull hypper-charts/our-app --untar

</code></pre>
<p>Now, let's lint. For example, linting against one of our test charts with
Hypper annotations should produce a warning due to a missing icon:</p>
<pre><code class="language-console">$ hypper lint ./our-app
==&gt; Linting our-app/
[INFO] Chart.yaml: icon is recommended

1 chart(s) linted, 0 chart(s) failed
</code></pre>
<p>While running it against a vanilla Helm chart with no extra Hypper annotations
will emit several <code>[INFO]</code>, recommending to set certain values that Hypper
supports:</p>
<pre><code class="language-console">$ hypper repo add bitnami https://charts.bitnami.com/bitnami
&quot;bitnami&quot; has been added to your repositories

$ hypper repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the &quot;hypper-charts&quot; chart repository
...Successfully got an update from the &quot;bitnami&quot; chart repository
🛳  Update Complete.

$ hypper pull bitnami/mariadb --untar

$ hypper lint ./mariadb
==&gt; Linting ./mariadb
[INFO] Chart.yaml: Setting hypper.cattle.io/release-name in annotations is recommended
[INFO] Chart.yaml: Setting hypper.cattle.io/namespace in annotations is recommended
[INFO] Chart.yaml: Setting hypper.cattle.io/shared-dependencies in annotations is optional
[INFO] Chart.yaml: Setting hypper.cattle.io/optional-dependencies in annotations is optional

1 chart(s) linted, 0 chart(s) failed
</code></pre>
<p>Running against a shared-dependencies annotation that is malformed will emit an <code>[ERROR]</code>. Let's edit the MariaDB chart, so it has a wrong <code>shared-dependencies</code> stanza, for example. Make the ./mariadb/Chart.yaml look like this:</p>
<pre><code class="language-diff"># this is a diff of ./mariadb/Cahrt.yaml

annotations:
  category: Database
+  hypper.cattle.io/shared-dependencies: |
+    - name: fleet
+      version: &quot;this-is-incorrect-0.3.500&quot;
+      repository: &quot;https://rancher-sandbox.github.io/hypper-charts/repo&quot;
apiVersion: v2
appVersion: 10.5.10
dependencies:
- name: common
  repository: https://charts.bitnami.com/bitnami
  tags:
  - bitnami-common
  version: 1.x.x
description: Fast, reliable, scalable, and easy to use open-source relational database
  system. MariaDB Server is intended for mission-critical, heavy-load production systems
  as well as for embedding into mass-deployed software. Highly available MariaDB cluster.
home: https://github.com/bitnami/charts/tree/master/bitnami/mariadb
icon: https://bitnami.com/assets/stacks/mariadb/img/mariadb-stack-220x234.png
keywords:
- mariadb
- mysql
- database
- sql
- prometheus
maintainers:
- email: containers@bitnami.com
  name: Bitnami
name: mariadb
sources:
- https://github.com/bitnami/bitnami-docker-mariadb
- https://github.com/prometheus/mysqld_exporter
- https://mariadb.org
version: 9.3.11

</code></pre>
<pre><code class="language-console">$ hypper lint ./mariadb
==&gt; Linting ./mariadb
[INFO] Chart.yaml: Setting hypper.cattle.io/release-name in annotations is recommended
[INFO] Chart.yaml: Setting hypper.cattle.io/namespace in annotations is recommended
[INFO] Chart.yaml: Setting hypper.cattle.io/optional-dependencies in annotations is optional
[ERROR] Chart.yaml: Shared dependency version is broken: improper constraint: this-is-incorrect-0.3.500

Error: 1 chart(s) linted, 1 chart(s) failed
</code></pre>
<p>Now if you were to set some kind of automated CI in place to check for linting
and are required to have Hypper annotations as mandatory, you can run <code>hypper lint</code> with the <code>--strict</code> flag so all warnings are marked as errors. For now, we
don't have warning-level messages.</p>
<h2><a class="header" href="#searching-for-charts-in-repos" id="searching-for-charts-in-repos">Searching for charts in repos</a></h2>
<p>Search reads through all the repositories configured on the system, and looks for matches. Searching on these repositories uses the metadata stored on the system.</p>
<p>It will display the latest stable versions of the charts found.</p>
<pre><code class="language-console">$ hypper search repo fleet
NAME                            CHART VERSION   APP VERSION     DESCRIPTION
hypper-charts/fleet             0.3.500         0.3.5           Fleet Manager - GitOps at Scale
hypper-charts/fleet-agent       0.3.500         0.3.5           Fleet Manager Agent - GitOps at Scale
hypper-charts/fleet-crd         0.3.500         0.3.5           Fleet Manager CustomResourceDefinitions
</code></pre>
<p>By default, it will only show the latest version that match the keyword used. In order to see all versions you can use the <code>-l</code> flag.</p>
<pre><code class="language-console">$ hypper search repo fleet-agent -l
NAME                            CHART VERSION   APP VERSION     DESCRIPTION
hypper-charts/fleet-agent       0.3.500         0.3.5           Fleet Manager Agent - GitOps at Scale
</code></pre>
<p>You can also search for a specific chart version by using the <code>--version VERSION</code> flag..</p>
<p>Note that VERSION needs to be a valid SemVer version.</p>
<pre><code class="language-console">$ hypper search repo fleet-agent --version 0.3.500
NAME              	CHART VERSION	APP VERSION	DESCRIPTION                          
hypper/fleet-agent	0.3.500      	0.3.5      	Fleet Manager Agent - GitOps at Scale
</code></pre>
<p>It's also possible to pass the <code>--regexp</code> flag to use regexp in the search.</p>
<pre><code class="language-console">$ hypper search repo &quot;fleet-&quot; --regexp
NAME                            CHART VERSION   APP VERSION     DESCRIPTION
hypper-charts/fleet-agent       0.3.500         0.3.5           Fleet Manager Agent - GitOps at Scale
hypper-charts/fleet-crd         0.3.500         0.3.5           Fleet Manager CustomResourceDefinitions
</code></pre>
<p>If you want to search for development charts (only stable charts are shown by default), use the <code>--devel</code> flag to show those development charts.</p>
<pre><code class="language-console">$ hypper search repo fleet-agent --devel
NAME                            CHART VERSION   APP VERSION     DESCRIPTION
hypper-charts/fleet-agent       0.3.500         0.3.5           Fleet Manager Agent - GitOps at Scale
</code></pre>
<h1><a class="header" href="#working-with-shared-dependencies" id="working-with-shared-dependencies">Working with shared dependencies</a></h1>
<p>Hypper charts support the concept of shared dependency charts.</p>
<p>A chart declared as a shared dependency is a chart that more than one chart may
depend on; once deployed, it can be reused by multiple other deployments. Charts
deployed as shared dependencies are the analogous of system libraries in an OS:
dependencies that are used by several consumers.</p>
<h2><a class="header" href="#creating-a-hypper-chart-with-shared-dependencies" id="creating-a-hypper-chart-with-shared-dependencies">Creating a Hypper chart with shared dependencies</a></h2>
<p>Let's create the simplest chart possible, and add charts as shared dependencies
to it.</p>
<p>First, we create a simple empty chart:</p>
<pre><code class="language-console">$ helm create our-app
</code></pre>
<p>Now, we can edit <code>./our-app/Chart.yaml</code>, and add some shared dependencies to it:</p>
<pre><code class="language-diff">apiVersion: v2
name: our-app
description: A Helm chart for Kubernetes
type: application
version: 0.1.0
appVersion: 1.16.0
annotations:
+ hypper.cattle.io/shared-dependencies: |
+   - name: fleet
+     version: &quot;^0.3.500&quot;
+     repository: &quot;https://rancher-sandbox.github.io/hypper-charts/repo&quot;
+ hypper.cattle.io/optional-dependencies: |
+   - name: rancher-tracing
+     version: &quot;^1.20.002&quot;
+     repository: &quot;https://rancher-sandbox.github.io/hypper-charts/repo&quot;
</code></pre>
<p>Shared dependencies are just normal Helm
<a href="https://helm.sh/docs/topics/charts/#chart-dependencies">Dependencies</a>. As
such, they are defined with:</p>
<ul>
<li>The name field is the name of the chart you want.</li>
<li>The version field is the version of the chart you want.</li>
<li>The repository field is the full URL to the chart repository. Note that you
must also use <code>hypper repo add</code> to add that repo locally. You might use the
name of the repo instead of URL.</li>
</ul>
<p>We can also add a default release name and namespace, where our-app and its
shared-dependencies will get installed:</p>
<pre><code class="language-diff">apiVersion: v2
name: our-app
description: A Helm chart for Kubernetes
type: application
version: 0.1.0
appVersion: 1.16.0
annotations:
+ hypper.cattle.io/namespace: hypper
+ hypper.cattle.io/release-name: our-app-name
  hypper.cattle.io/shared-dependencies: |
    - name: fleet
      version: &quot;^0.3.500&quot;
      repository: &quot;https://rancher-sandbox.github.io/hypper-charts/repo&quot;
  hypper.cattle.io/optional-dependencies: |
    - name: rancher-tracing
      version: &quot;^1.20.002&quot;
      repository: &quot;https://rancher-sandbox.github.io/hypper-charts/repo&quot;
</code></pre>
<p>To verify that we did create the correctly, let's lint it:</p>
<pre><code class="language-console">$ hypper lint ./our-app
==&gt; Linting our-app
[INFO] Chart.yaml: icon is recommended

1 chart(s) linted, 0 chart(s) failed
</code></pre>
<h2><a class="header" href="#listing-shared-dependencies" id="listing-shared-dependencies">Listing shared dependencies</a></h2>
<p>Hypper's <code>shared-dep list</code> command will list the shared dependencies, its status, and other information:</p>
<pre><code class="language-console">$ hypper shared-deps list ./our-app
NAME            VERSION         REPOSITORY                                              STATUS          NAMESPACE       TYPE
fleet           ^0.3.500        https://rancher-sandbox.github.io/hypper-charts/repo    not-installed   fleet-system    shared
rancher-tracing ^1.20.002       https://rancher-sandbox.github.io/hypper-charts/repo    not-installed   istio-system    shared-optional
</code></pre>
<h2><a class="header" href="#deploying-shared-dependencies" id="deploying-shared-dependencies">Deploying shared dependencies</a></h2>
<p>Now, let's pretend that we had <code>fleet</code> already installed, so let's install
it by hand.</p>
<p>First, add the repos of the <code>fleet</code> shared dependency, so they are found when
installing manually.</p>
<p>Note that, when hypper installs the shared dependency on its own, you don't need
to add the repos.</p>
<pre><code class="language-console">$ hypper repo add hypper-charts 'https://rancher-sandbox.github.io/hypper-charts/repo'
&quot;hypper-charts&quot; has been added to your repositories
$ hypper repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the &quot;hypper-charts&quot; chart repository
🛳  Update Complete.
</code></pre>
<p>Now we install <code>fleet</code>:</p>
<pre><code class="language-console">$ hypper install hypper-charts/fleet -n fleet-system
🛳  Installing chart &quot;fleet&quot; as &quot;fleet&quot; in namespace &quot;fleet-system&quot;…
👏 Done!
</code></pre>
<p>That satisfies one shared dependency of <code>our-app</code>:</p>
<pre><code class="language-console">$ hypper shared-deps list ./our-app
NAME            VERSION         REPOSITORY                                              STATUS          NAMESPACE       TYPE
fleet           ^0.3.500        https://rancher-sandbox.github.io/hypper-charts/repo    deployed        fleet-system    shared
rancher-tracing ^1.20.002       https://rancher-sandbox.github.io/hypper-charts/repo    not-installed   istio-system    shared-optional
</code></pre>
<p>Then, we can install <code>our-app</code>, and any of its missing shared dependencies.
By default, Hypper asks for each optional shared dependency if we want to
install it or not:</p>
<pre><code class="language-console">$ hypper install ./our-app
❓ Install optional shared dependency &quot;rancher-tracing&quot; of chart &quot;demo&quot;? [Y/n]:
y
The following charts are going to be installed:
our-app v0.1.0
 ├─ fleet v0.3.500
 └─ rancher-tracing v1.20.002

🛳  Installing chart &quot;fleet&quot; as &quot;fleet&quot; in namespace &quot;fleet-system&quot;…
🛳  Installing chart &quot;rancher-tracing&quot; as &quot;rancher-tracing&quot; in namespace &quot;istio-system&quot;…
🛳  Installing chart &quot;our-app&quot; as &quot;our-app-name&quot; in namespace &quot;hypper&quot;…
👏 Done!
</code></pre>
<p>What has happened?</p>
<ol>
<li>Hypper has made sure that all declared shared dependencies of <code>our-app</code> are
satisfied, installing those that are missing, and skipping those present.
Since the chart of the shared dependency didn't have annotations for default
namespace, it will install them on the dependent namespace.</li>
<li>Since we haven't specified the release name or namespace in the command,
Hypper has installed <code>our-app</code> in the default release-name (<code>our-app-name</code>)
and namespace (<code>hypper</code>) we specified in the Hypper annotations.</li>
</ol>
<p>Let's see:</p>
<pre><code class="language-console">$ ./bin/hypper shared-deps list ./our-app
NAME            VERSION         REPOSITORY                                              STATUS          NAMESPACE       TYPE
fleet           ^0.3.500        https://rancher-sandbox.github.io/hypper-charts/repo    deployed        fleet-system    shared
rancher-tracing ^1.20.002       https://rancher-sandbox.github.io/hypper-charts/repo    deployed        istio-system    shared-optional

$ hypper list -A
NAME            NAMESPACE       REVISION        UPDATED                                         STATUS          CHART                           APP VERSION
fleet           fleet-system    1               2021-05-17 17:32:45.889083671 +0200 CEST        deployed        fleet-0.3.500                   0.3.5
our-app-name    hypper          1               2021-05-17 17:35:13.517422915 +0200 CEST        deployed        our-app-0.0.2                   0.0.1
rancher-tracing istio-system    1               2021-05-17 17:35:13.311231418 +0200 CEST        deployed        rancher-tracing-1.20.002        1.20.0
</code></pre>
<p>Yay! they are all installed.</p>
<p>If you want, you can always install <code>our-app</code> without the shared-dependencies,
by passing the flag <code>--no-shared-deps</code>. And you can either install all optional
dependencies by default with <code>--optional-deps=all</code>, or skip them with
<code>--optional-deps=none</code>.</p>
<h1><a class="header" href="#reference-guides" id="reference-guides">Reference guides</a></h1>
<p>You can find Golang reference guides in
<a href="https://pkg.go.dev/github.com/rancher-sandbox/hypper">pkg.go.dev/github.com/rancher-sandbox/hypper</a>,
particularly for the <a href="https://pkg.go.dev/github.com/rancher-sandbox/hypper/pkg">Hypper library API</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
